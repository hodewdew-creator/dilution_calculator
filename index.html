<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ë²”ìš© ì•½ë¬¼ í¬ì„ ê³„ì‚°ê¸°</title>
  <style>
    :root{ --blue:#2563eb; --bg:#f9fafb; --card:#fff; --border:#e5e7eb; --muted:#6b7280; --ink:#111827; --accent:#34d399; --warn:#b91c1c }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink);padding:24px}
    h2{margin:0 0 16px;font-size:1.45rem;color:var(--blue);text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}
    h2 .icon{font-size:1.5rem;color:var(--accent)}

    /* Card (ìš©ëŸ‰ ê³„ì‚°ê¸°ì™€ í†µì¼) */
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;max-width:580px;margin:0 auto;box-shadow:0 3px 8px rgba(0,0,0,.06);transition:transform .2s}
    .card:hover{transform:translateY(-2px)}

    .row{display:flex;flex-direction:column;gap:14px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (max-width:560px){ .grid{grid-template-columns:1fr} }

    label{font-size:.92rem;font-weight:600;margin-bottom:4px;color:#1e40af}
    input, select{padding:9px;font-size:1rem;border:1px solid var(--border);border-radius:10px;text-align:center;background:#fff;transition:border .2s}
    input:focus, select:focus{border-color:var(--blue);outline:none;box-shadow:0 0 0 2px rgba(37,99,235,.2)}

    .inline{display:flex;gap:4px;align-items:center}
    .inline input{flex:0 0 80px;min-width:60px}
    .unit{flex:1;min-width:80px;max-width:140px}
    select option.red{color:var(--warn);font-weight:700}

    .result{margin-top:12px;font-size:1.08rem;font-weight:700;color:#1e3a8a;text-align:center;line-height:1.5;padding:10px;border-radius:10px;background:#f1f5f9}

    .small{font-size:.85rem;color:#334155;text-align:center}
  </style>
</head>
<body>
  <h2><span class="icon">ğŸ§´</span> ë²”ìš© ì•½ë¬¼ í¬ì„ ê³„ì‚°ê¸°</h2>

  <section class="card">
    <div class="row">
      <div class="grid">
        <div>
          <label>ì•½ë¬¼ ì´ë¦„</label>
          <input id="p_name" placeholder="ì…ë ¥í•´ì£¼ì„¸ìš”" />
        </div>
        <div>
          <label>ë¶„ë§ ì´ëŸ‰</label>
          <div class="inline">
            <input id="p_mass" type="number" min="0" step="0.1" placeholder="ì˜ˆ: 500" />
            <select id="p_mass_unit" class="unit">
              <option value="mg">mg</option>
              <option value="g">g</option>
            </select>
          </div>
        </div>
        <div>
          <label>ëª©í‘œ ë†ë„</label>
          <div class="inline">
            <input id="p_target" type="number" min="0" step="0.01" placeholder="ì˜ˆ: 50" />
            <select id="p_target_unit" class="unit">
              <option value="mg/mL" selected>mg/mL (ê¸°ë³¸)</option>
              <option value="ug/mL">ug/mL</option>
              <option value="mg/0.1mL" class="red">mg/0.1mL *</option>
              <option value="ug/0.1mL" class="red">ug/0.1mL *</option>
            </select>
          </div>
          <div class="small" id="u_hint">ìµœì¢… ê²°ê³¼ëŠ” ì•„ë˜ì— mL ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
      </div>

      <div class="result" id="p_out">
        í¬ì„ë²•<br>
        <span class="small" id="p_out_detail">ì•½ë¬¼ì„ í¬ì„ì•¡ - mL ì— ì¡°ì œí•´ì£¼ì„¸ìš”.</span>
      </div>
    </div>
  </section>

  <script>
    // --- ìœ í‹¸: ë‹¨ìœ„ ë³€í™˜ ---
    const massFactorMg = { 'g': 1000, 'mg': 1, 'ug': 0.001 };
    const concTo_mg_per_mL = (val, unit) => {
      if(!isFinite(val)) return NaN;
      switch(unit){
        case 'mg/mL': return val;
        case 'ug/mL': return val * 0.001;          // ug/mL â†’ mg/mL
        case 'mg/0.1mL': return val * 10;          // mg/0.1mL â†’ mg/mL
        case 'ug/0.1mL': return val * 0.01;        // ug/0.1mL â†’ mg/mL
        default: return NaN;
      }
    };

    // --- UI: 0.1 mL ê²½ê³  ë¬¸êµ¬ (í•˜ë‹¨ë§Œ) ---
    function updateUnitHint(){
      const sel = document.getElementById('p_target_unit');
      const hint = document.getElementById('u_hint');
      const is01 = /0\.1mL$/.test(sel.value);
      hint.innerHTML = is01
        ? '<span style="color:#b91c1c;font-weight:700">* 0.1 mL ê¸°ì¤€ ë‹¨ìœ„ì…ë‹ˆë‹¤.</span>'
        : 'ìµœì¢… ê²°ê³¼ëŠ” ì•„ë˜ì— mL ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.';
    }

    // --- ë¶„ë§í˜• ê³„ì‚° ---
    function calcPowder(){
      const mass = parseFloat(document.getElementById('p_mass').value);
      const mUnit = document.getElementById('p_mass_unit').value;
      const tgt = parseFloat(document.getElementById('p_target').value);
      const tUnit = document.getElementById('p_target_unit').value;

      const mass_mg = mass * (massFactorMg[mUnit] || 1);
      const target_mg_per_mL = concTo_mg_per_mL(tgt, tUnit);

      const out = document.getElementById('p_out_detail');
      let add='-';

      if(isFinite(mass_mg) && mass_mg>0 && isFinite(target_mg_per_mL) && target_mg_per_mL>0){
        const V = mass_mg / target_mg_per_mL; // mL
        add = `${V.toFixed(2)} mL`;
      }
      out.textContent = `ì•½ë¬¼ì„ í¬ì„ì•¡ ${add} ì— ì¡°ì œí•´ì£¼ì„¸ìš”.`;
    }

    // --- ë°”ì¸ë”© ---
    ['p_name','p_mass','p_mass_unit','p_target','p_target_unit'].forEach(id=>{
      document.getElementById(id).addEventListener('input', ()=>{ if(id==='p_target_unit') updateUnitHint(); calcPowder(); });
      document.getElementById(id).addEventListener('change', ()=>{ if(id==='p_target_unit') updateUnitHint(); calcPowder(); });
    });

    // --- ì´ˆê¸°í™” ---
    updateUnitHint();
    calcPowder();

    // =================
    // ê°œë°œìš© ê°„ë‹¨ í…ŒìŠ¤íŠ¸
    // =================
    (function runTests(){
      const nearly = (a,b,eps=1e-9)=> Math.abs(a-b) < eps;
      const tests = [];

      // ë‹¨ìœ„ ë³€í™˜ í…ŒìŠ¤íŠ¸ (ug í‘œê¸°)
      tests.push(['conv mg/0.1mL â†’ mg/mL', nearly(concTo_mg_per_mL(5,'mg/0.1mL'), 50)]);
      tests.push(['conv ug/mL â†’ mg/mL', nearly(concTo_mg_per_mL(500,'ug/mL'), 0.5)]);
      tests.push(['conv ug/0.1mL â†’ mg/mL', nearly(concTo_mg_per_mL(100,'ug/0.1mL'), 1)]); // 100 ug/0.1mL = 1 mg/mL

      // ë¶„ë§: 500 mg â†’ 50 mg/mL â‡’ 10 mL
      const Vpow = 500 / 50;
      tests.push(['powder V', nearly(Vpow, 10)]);

      if(window.console && console.groupCollapsed){
        console.groupCollapsed('%cSelf-tests','background:#eef;padding:2px 6px;border-radius:6px');
        tests.forEach(([name, ok])=> console[ok? 'log':'error'](`${ok?'âœ…':'âŒ'} ${name}`));
        console.groupEnd();
      }
    })();
  </script>
</body>
</html>
